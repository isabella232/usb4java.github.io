<!DOCTYPE html>
<!--
 | Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/apt/quickstart/javax-usb.apt at 2018-10-21
 | Rendered using Apache Maven Fluido Skin 1.7
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="Date-Revision-yyyymmdd" content="20181021" />
    <meta http-equiv="Content-Language" content="en" />
    <title>usb4java &#x2013; High-level (javax-usb) API</title>
    <link rel="stylesheet" href="../css/apache-maven-fluido-1.7.min.css" />
    <link rel="stylesheet" href="../css/site.css" />
    <link rel="stylesheet" href="../css/print.css" media="print" />
    <script type="text/javascript" src="../js/apache-maven-fluido-1.7.min.js"></script>
<link href="favicon.ico" rel="SHORTCUT ICON" />
  </head>
  <body class="topBarDisabled">
    <a href="https://github.com/usb4java">
      <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
        src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png"
        alt="Fork me on GitHub">
    </a>
    <div class="container-fluid">
      <div id="banner">
        <div class="pull-left"><a href=".././" id="bannerLeft"><img src="../images/logo.png"  alt="usb4java"/></a></div>
        <div class="pull-right"></div>
        <div class="clear"><hr/></div>
      </div>

      <div id="breadcrumbs">
        <ul class="breadcrumb">
        <li id="publishDate">Last Published: 2018-10-21<span class="divider">|</span>
</li>
          <li id="projectVersion">Version: 1.3.0<span class="divider">|</span></li>
      <li class=""><a href=".././" title="usb4java">usb4java</a><span class="divider">/</span></li>
    <li class="active ">High-level (javax-usb) API</li>
      <li class="pull-right"><span class="divider">|</span>
<a href="http://libusb.info/" class="externalLink" title="libusb">libusb</a></li>
      <li class="pull-right"><a href="http://javax-usb.sourceforge.net/" class="externalLink" title="javax-usb">javax-usb</a></li>
        </ul>
      </div>
      <div class="row-fluid">
        <div id="leftColumn" class="span2">
          <div class="well sidebar-nav">
    <ul class="nav nav-list">
      <li class="nav-header">usb4java</li>
    <li><a href="../index.html" title="About"><span class="none"></span>About</a></li>
    <li><a href="../quickstart/index.html" title="Quick start"><span class="icon-chevron-down"></span>Quick start</a>
    <ul class="nav nav-list">
    <li><a href="../quickstart/libusb.html" title="Low-level (libusb) API"><span class="none"></span>Low-level (libusb) API</a></li>
    <li class="active"><a href="#"><span class="none"></span>High-level (javax-usb) API</a></li>
    </ul>
</li>
    <li><a href="../faq.html" title="FAQ"><span class="none"></span>FAQ</a></li>
    <li><a href="../configuration.html" title="Configuration"><span class="none"></span>Configuration</a></li>
    <li><a href="../nativelibs.html" title="Native libs"><span class="none"></span>Native libs</a></li>
      <li class="nav-header">Project Documentation</li>
    <li><a href="../project-info.html" title="Project Information"><span class="icon-chevron-right"></span>Project Information</a></li>
    <li><a href="../project-reports.html" title="Project Reports"><span class="icon-chevron-right"></span>Project Reports</a></li>
</ul>
          <hr />
          <div id="poweredBy">
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
            <div class="clear"></div>
<a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy"><img class="builtBy" alt="Built by Maven" src="../images/logos/maven-feather.png" /></a>
            </div>
          </div>
        </div>
        <div id="bodyColumn"  class="span10" >
<div class="section">
<h2><a name="High-level_.28javax-usb.29_API"></a>High-level (javax-usb) API</h2>
<p>The high-level API implements the <a class="externalLink" href="http://javax-usb.sourceforge.net/">javax-usb (JSR-80)</a> standard. This API is object-oriented, event-driven and uses exceptions for error-handling instead of negative return values like the low-level API. Another advantage is that you may switch to a different <i>javax-usb</i> implementation later without changing your code. For example instead of using <i>usb4java</i> you may try out the reference implementation for Linux and Windows.</p>
<div class="section">
<h3><a name="Configuration"></a>Configuration</h3>
<p>To use the <i>usb4java</i> implementation you have to create a file named <i><a href="../configuration.html">javax.usb.properties</a></i> in the root of your class path with the following content:</p>
<div class="source"><pre class="prettyprint">javax.usb.services = org.usb4java.javax.Services</pre></div></div>
<div class="section">
<h3><a name="Finding_USB_devices"></a>Finding USB devices</h3>
<p>USB devices are managed in a tree. The root of this tree is a virtual USB hub to which all physical root hubs are connected. More hubs can be connected to these root hubs and any hub can have a number of connected USB devices. </p>
<p>Often you need to search for a specific device before working with it. Here is an example how to scan the device tree for the first device with a specific vendor and product id. It can be easily expanded to check for specific device classes or whatever:</p>
<div class="source"><pre class="prettyprint">public UsbDevice findDevice(UsbHub hub, short vendorId, short productId)
{
    for (UsbDevice device : (List&lt;UsbDevice&gt;) hub.getAttachedUsbDevices())
    {
        UsbDeviceDescriptor desc = device.getUsbDeviceDescriptor();
        if (desc.idVendor() == vendorId &amp;&amp; desc.idProduct() == productId) return device;
        if (device.isUsbHub())
        {
            device = findDevice((UsbHub) device, vendorId, productId);
            if (device != null) return device;
        }
    }
    return null;
}</pre></div></div>
<div class="section">
<h3><a name="Control_requests"></a>Control requests</h3>
<p>This example reads the current configuration number from a device by using a control request:</p>
<div class="source"><pre class="prettyprint">UsbControlIrp irp = device.createUsbControlIrp(
    (byte) (UsbConst.REQUESTTYPE_DIRECTION_IN
          | UsbConst.REQUESTTYPE_TYPE_STANDARD
          | UsbConst.REQUESTTYPE_RECIPIENT_DEVICE),
    UsbConst.REQUEST_GET_CONFIGURATION,
    (short) 0,
    (short) 0
    );
irp.setData(new byte[1]);
device.syncSubmit(irp);
System.out.println(irp.getData()[0]);</pre></div></div>
<div class="section">
<h3><a name="Interfaces"></a>Interfaces</h3>
<p>When you want to communicate with an interface or with endpoints of this interface then you have to claim it before using it and you have to release it when you are finished. Example:</p>
<div>
<pre>UsbConfiguration configuration = device.getActiveUsbConfiguration();
UsbInterface iface = configuration.getUsbInterface((byte) 1);
iface.claim();
try
{
    ... Communicate with the interface or endpoints ...
}
finally        
{
    iface.release();
}</pre></div>
<p>It is possible that the interface you want to communicate with is already used by a kernel driver. In this case you can try to force the claiming by passing an interface policy to the <tt>claim</tt> method:</p>
<div>
<pre>iface.claim(new UsbInterfacePolicy()
{            
    @Override
    public boolean forceClaim(UsbInterface usbInterface)
    {
        return true;
    }
});</pre></div>
<p>Please note that interface policies are just a hint for the underlying USB implementation. In case of <i>usb4java</i> the policy will be ignored on Windows because <i>libusb</i> doesn't support detaching drivers on Windows.</p></div>
<div class="section">
<h3><a name="Synchronous_I.2FO"></a>Synchronous I/O</h3>
<p>This example sends 8 bytes to endpoint 0x03:</p>
<div>
<pre>UsbEndpoint endpoint = iface.getUsbEndpoint(0x03);
UsbPipe pipe = endpoint.getUsbPipe();
pipe.open();
try
{
    int sent = pipe.syncSubmit(new byte[] { 1, 2, 3, 4, 5, 6, 7, 8 });
    System.out.println(sent + &quot; bytes sent&quot;);
}
finally
{
    pipe.close();
}</pre></div>
<p>This example reads 8 bytes from endpoint 0x83:</p>
<div>
<pre>UsbEndpoint endpoint = iface.getUsbEndpoint((byte) 0x83);
UsbPipe pipe = endpoint.getUsbPipe();
pipe.open();
try
{
    byte[] data = new byte[8];
    int received = pipe.syncSubmit(data);
    System.out.println(received + &quot; bytes received&quot;);
}
finally
{
    pipe.close();
}</pre></div></div>
<div class="section">
<h3><a name="Asynchronous_I.2FO"></a>Asynchronous I/O</h3>
<p>Asynchronous I/O works pretty much the same as synchronous I/O. You just use the <tt>asyncSubmit</tt> methods instead of the <tt>syncSubmit</tt> methods. While <tt>syncSubmit</tt> blocks until the request is complete <tt>asyncSubmit</tt> does not block and return immediately. To receive the response you have to add a listener to the pipe like this:</p>
<div>
<pre>pipe.addUsbPipeListener(new UsbPipeListener()
{            
    @Override
    public void errorEventOccurred(UsbPipeErrorEvent event)
    {
        UsbException error = event.getUsbException();
        ... Handle error ...
    }
    
    @Override
    public void dataEventOccurred(UsbPipeDataEvent event)
    {
        byte[] data = event.getData();
        ... Process received data ...
    }
});</pre></div></div>
<div class="section">
<h3><a name="See_also"></a>See also</h3>
<ul>
<li><a href="../usb4java-javax/apidocs/index.html">API documentation of usb4java-javax</a></li>
<li><a class="externalLink" href="https://github.com/usb4java/usb4java-javax-examples/">usb4java-javax examples</a></li>
<li><a class="externalLink" href="http://javax-usb.sourceforge.net/">javax-usb website</a></li></ul></div></div>
        </div>
      </div>
    </div>
    <hr/>
    <footer>
      <div class="container-fluid">
        <div class="row-fluid">
            <p>Copyright &copy;2011&#x2013;2018
<a href="http://usb4java.org/">usb4java Team</a>.
All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>
